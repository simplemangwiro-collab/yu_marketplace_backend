{% extends "base.html" %}

{% block content %}
  {% if session.username %}
    <h2>Welcome, {{ session.username }}!</h2>
  {% endif %}
  <h3 class="mb-4">Available Products</h3>

  <!-- Search Bar -->
  <form method="get" action="/items" class="mb-4">
    <div class="input-group">
      <input type="text" name="search" class="form-control" placeholder="Search by product name or seller..." value="{{ request.args.get('search', '') }}">
      <button class="btn btn-outline-secondary" type="submit">
        <i class="bi bi-search"></i> Search
      </button>
    </div>
  </form>

  <!-- Category Filter -->
  <form method="get" action="/items" class="mb-4">
    <label for="category" class="form-label">Filter by Category:</label>
    <select name="category" id="category" class="form-select" onchange="this.form.submit()">
      <option value="">All</option>
      <option value="Stationery" {% if selected_category == 'Stationery' %}selected{% endif %}>Stationery</option>
      <option value="Electronics" {% if selected_category == 'Electronics' %}selected{% endif %}>Electronics</option>
      <option value="Clothing" {% if selected_category == 'Clothing' %}selected{% endif %}>Clothing</option>
    </select>
  </form>

  <!-- Product List -->
  {% if items %}
    <ul class="list-group">
      {% for item in items %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            <strong>{{ item['product_name'] }}</strong> â€” {{ item['category'] }}<br>
            <small>Seller: {{ item['seller'] }}</small>
          </div>
          <div>
            {% if item['seller'] == session.username %}
              <a href="/edit/{{ item['id'] }}" class="btn btn-sm btn-warning me-2">
                <i class="bi bi-pencil-square"></i> Edit
              </a>
              <form method="POST" action="/delete/{{ item['id'] }}" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-danger">
                  <i class="bi bi-trash"></i> Delete
                </button>
              </form>
            {% endif %}
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <div class="alert alert-info mt-4" role="alert">
      No products found. Try adjusting your search or filter.
    </div>
  {% endif %}
{% endblock %}
